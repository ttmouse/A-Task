# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 项目概述

A-Task 是一个浏览器插件（Chrome Extension），用于管理和自动化多个 AI 网站（ChatGPT、Gemini 等）的任务队列。

### 核心功能
- **任务队列管理** - 为多个 AI 网站维护任务列表
- **智能监控** - 监控任务完成状态（如图片生成、对话完成）
- **自动化执行** - 检测到任务完成后自动提交下一个任务
- **多站点支持** - 不同网站有不同的任务配置和监控规则

## 技术栈

- **Chrome Extension Manifest V3** - 必须使用 V3 规范
- **内容脚本（Content Scripts）** - 注入到目标网站进行监控和操作
- **Service Worker** - 后台任务管理和状态同步
- **chrome.storage API** - 任务队列和配置持久化

## 架构设计原则

### 适配器模式（关键）
每个 AI 网站需要独立的适配器实现：

```
src/
├── adapters/
│   ├── base-adapter.ts       # 适配器基类
│   ├── chatgpt-adapter.ts    # ChatGPT 适配器
│   ├── gemini-adapter.ts     # Gemini 适配器
│   └── ...                   # 其他 AI 站点适配器
```

每个适配器必须实现：
- `submitTask()` - 提交任务到网站
- `checkStatus()` - 检查任务完成状态
- `getResult()` - 获取生成结果
- `cleanup()` - 清理和重置

### 任务队列系统
- 使用 `chrome.storage.local` 持久化任务队列
- 支持任务优先级和依赖关系
- 失败自动重试机制
- 任务状态：pending → running → completed/failed

### 监控机制
- 使用 `MutationObserver` 监控 DOM 变化
- 定期轮询检查（避免过度监控）
- 事件驱动的状态更新

## 开发注意事项

### Chrome 扩展开发规范
- 必须遵守 Manifest V3 规范
- 优先考虑用户体验和性能
- 遵守目标网站使用条款
- 数据仅在用户授权下获取
- 不能进行大规模自动化抓取

### 锚点注释规范
在复杂或关键代码处添加：
- `AIDEV-NOTE:` - 重要实现说明
- `AIDEV-TODO:` - 待实现功能
- `AIDEV-QUESTION:` - 需要确认的设计决策

### AI 绝不能做的事情
1. **永远不要假设网站 DOM 结构** - 必须先检查实际页面
2. **永远不要硬编码选择器** - 使用配置化的选择器
3. **永远不要绕过用户授权** - 所有操作需用户同意
4. **永远不要违反网站使用条款** - 避免过度自动化

## 待确认的设计决策

以下问题需要在实现前与用户确认：

1. **使用场景**：
   - 主要用于批量生成图片？还是也包括文本对话任务？
   - 任务之间有依赖关系吗？（比如用A的结果作为B的输入）

2. **监控粒度**：
   - 只需要知道"完成/未完成"？还是需要实时进度？
   - 如果生成失败，需要自动重试吗？

3. **交互方式**：
   - 任务列表在哪里管理？侧边栏？独立页面？
   - 需要手动添加任务还是支持批量导入？

4. **数据处理**：
   - 生成的结果需要自动下载吗？
   - 需要保存任务历史记录吗？

## 核心工作原则

- **严格按照明确需求实现** - 只实现用户明确要求的功能
- **避免过度设计** - 不添加"可能需要"的功能
- **保持简洁** - 选择最简单直接的实现方案
- **沟通优先** - 不确定时始终询问开发者

## 语言偏好

- 代码注释使用中文
- 与用户沟通使用中文
- 文档使用中文
