<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Task 任务管理</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="app-container">
    <!-- 主布局容器 (无侧边栏) -->
    <div class="main-layout">
      <!-- 2. 顶部导航栏 (Top Nav) -->
      <header class="top-nav">
        <div class="nav-left">
           <h1 id="panelTitle" class="panel-title">A-Task</h1>
        </div>
        
        <!-- 新的操作功能区 -->
        <div class="nav-toolbar">
          <button id="addTaskBtn" class="toolbar-btn primary" title="添加任务">
            <i class="ri-add-line"></i>
            <span>New</span>
          </button>
          <button id="guideBtn" class="toolbar-btn" title="使用指南">
            <i class="ri-book-open-line"></i>
            <span>Help</span>
          </button>
          <button id="manualInjectBtn" class="toolbar-btn" title="手动注入 Content Script">
            <i class="ri-tools-line"></i>
            <span>Inject</span>
          </button>
        </div>

        <div class="nav-right">
           <!-- 状态检测按钮 -->
           <button id="checkPageStatusBtn" class="icon-btn" title="刷新状态">
             <i class="ri-refresh-line"></i>
           </button>
           
           <!-- 分隔线 -->
           <div class="nav-divider"></div>

           <!-- 状态指示器 -->
           <div class="status-indicator-group" id="pageStatusItem">
              <span class="status-dot" id="statusPageDot"></span>
              <span class="status-text" id="statusPageText">Ready</span>
           </div>
           
           <!-- 隐藏的连接状态 -->
           <div id="connectionStatusItem" style="display:none;">
             <span id="statusConnectionDot"></span>
             <span id="statusConnectionText"></span>
           </div>
        </div>
      </header>


      <!-- 工作区主体 (Canvas + Right Panel) -->
      <div class="workspace-body">
        <!-- 3. 中间画布/列表 (Main Canvas) -->
        <div class="content-area" id="taskList">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">
              <i class="ri-clipboard-line" style="font-size: 48px;"></i>
            </div>
            <p>No tasks yet</p>
            <button class="btn-ghost" onclick="document.getElementById('addTaskBtn').click()">Create one</button>
          </div>
        </div>

        <!-- 4. 右侧属性面板 (Right Property Panel / Logs) -->
        <aside class="right-panel" id="logPanel">
          <div class="inspector-header">
            <span class="tab active">Console</span>
            <div class="inspector-actions">
              <button id="clearLogsBtn" class="icon-btn-xs" title="Clear">
                <i class="ri-delete-bin-7-line"></i>
              </button>
            </div>
          </div>
          <div class="log-content" id="debugContent">
            <div class="log-empty">System ready...</div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- 添加/编辑任务浮层 -->
  <div class="modal" id="addTaskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">添加新任务</h2>
        <button class="close-btn" id="closeModalBtn">&times;</button>
      </div>
      <div class="modal-body">
        <!-- 隐藏字段：正在编辑的任务 ID -->
        <input type="hidden" id="editingTaskId" value="">

        <div class="form-group">
          <label for="taskTypeSelect">任务类型</label>
          <select id="taskTypeSelect" class="form-control">
            <option value="text">文本对话</option>
            <option value="image">图片生成</option>
          </select>
        </div>
        <div class="form-group">
          <label for="promptInput">
            提示词
            <span style="color: #666; font-size: 12px;">(使用 -------- 分隔多个步骤)</span>
          </label>
          <textarea
            id="promptInput"
            class="form-control"
            rows="8"
            placeholder="请输入提示词内容...&#10;&#10;提示：使用 -------- 分隔多个步骤，任务将逐步执行"></textarea>
        </div>
        <div class="form-group">
          <label for="maxRetriesInput">最大重试次数</label>
          <input
            type="number"
            id="maxRetriesInput"
            class="form-control"
            value="3"
            min="0"
            max="10">
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelBtn" class="btn-secondary">取消</button>
        <button id="submitTaskBtn" class="btn-primary">添加任务</button>
      </div>
    </div>
  </div>

  <script type="module" src="sidepanel.js"></script>
</body>
</html>
